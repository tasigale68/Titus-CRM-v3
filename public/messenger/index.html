<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1B3A5C">
  <title>Titus Messenger</title>
  <link rel="manifest" href="/messenger/manifest.json">
  <link rel="apple-touch-icon" href="/images/icon-192.png">
  <link rel="stylesheet" href="/messenger/styles.css">
</head>
<body>
  <div class="app-container">

    <!-- App Header -->
    <div class="app-header">
      <button class="back-btn" id="header-back-btn" onclick="App.showListView()" aria-label="Back">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M13 16L7 10L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <h1>Titus Messenger</h1>
      <div class="header-actions">
        <span id="user-name"></span>
      </div>
    </div>

    <!-- Tab Bar -->
    <div class="tab-bar" id="tab-bar">
      <button class="tab active" data-tab="all" onclick="App.switchTab('all')">All</button>
      <button class="tab" data-tab="chats" onclick="App.switchTab('chats')">Chats</button>
      <button class="tab" data-tab="my_messages" onclick="App.switchTab('my_messages')">My Messages</button>
    </div>

    <!-- Conversation List View -->
    <div id="list-view" class="conv-list">
      <div id="conv-list"></div>
    </div>

    <!-- Chat Thread View -->
    <div id="chat-view" class="chat-view">
      <div class="chat-header">
        <button class="back-btn" onclick="App.showListView()" aria-label="Back">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none"><path d="M13 16L7 10L13 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="chat-header-info">
          <div class="chat-header-title" id="chat-title">Chat</div>
          <div class="chat-header-sub" id="chat-subtitle"></div>
        </div>
        <div class="chat-header-actions">
          <button id="media-btn" onclick="Chat.showMediaGallery()" title="Media" style="display:none" aria-label="Media gallery">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="3" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><circle cx="8.5" cy="8.5" r="1.5" fill="currentColor"/><path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
          <button id="members-btn" onclick="Chat.showMembers()" title="Members" aria-label="Members">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M17 21V19C17 16.79 15.21 15 13 15H5C2.79 15 1 16.79 1 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/><path d="M23 21V19C23 17.14 21.73 15.57 20 15.13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M16 3.13C17.73 3.57 19 5.14 19 7C19 8.86 17.73 10.43 16 10.87" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </button>
        </div>
      </div>

      <div class="messages-container" id="messages">
        <div class="empty-state">
          <div class="empty-icon">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none"><path d="M21 15C21 15.53 20.79 16.04 20.41 16.41C20.04 16.79 19.53 17 19 17H7L3 21V5C3 4.47 3.21 3.96 3.59 3.59C3.96 3.21 4.47 3 5 3H19C19.53 3 20.04 3.21 20.41 3.59C20.79 3.96 21 4.47 21 5V15Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
          </div>
          <h3>No messages yet</h3>
          <p>Send the first message</p>
        </div>
      </div>

      <!-- Attachment previews -->
      <div class="attachment-preview" id="attachment-previews"></div>

      <!-- Input bar -->
      <div class="chat-input-bar">
        <button class="input-btn mic-btn" id="mic-btn" onclick="VoiceInput.toggle()" title="Voice input" aria-label="Voice input">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M12 1C11.2 1 10.44 1.32 9.88 1.88C9.32 2.44 9 3.2 9 4V12C9 12.8 9.32 13.56 9.88 14.12C10.44 14.68 11.2 15 12 15C12.8 15 13.56 14.68 14.12 14.12C14.68 13.56 15 12.8 15 12V4C15 3.2 14.68 2.44 14.12 1.88C13.56 1.32 12.8 1 12 1Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M19 10V12C19 13.86 18.26 15.64 16.95 16.95C15.64 18.26 13.86 19 12 19C10.14 19 8.36 18.26 7.05 16.95C5.74 15.64 5 13.86 5 12V10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 19V23" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 23H16" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <textarea id="msg-input" rows="1" placeholder="Type a message..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();App.sendMessage()}"></textarea>
        <button class="input-btn attach-btn" onclick="document.getElementById('file-input').click()" title="Attach file" aria-label="Attach file">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M21.44 11.05L12.25 20.24C11.12 21.37 9.58 22 7.97 22C6.36 22 4.82 21.37 3.69 20.24C2.56 19.11 1.93 17.57 1.93 15.96C1.93 14.35 2.56 12.81 3.69 11.68L12.88 2.49C13.64 1.73 14.67 1.3 15.74 1.3C16.81 1.3 17.84 1.73 18.6 2.49C19.36 3.25 19.79 4.28 19.79 5.35C19.79 6.42 19.36 7.45 18.6 8.21L9.4 17.4C9.02 17.78 8.5 18 7.97 18C7.44 18 6.93 17.78 6.54 17.4C6.16 17.02 5.94 16.5 5.94 15.97C5.94 15.44 6.16 14.92 6.54 14.54L15.07 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <input type="file" id="file-input" multiple accept="image/jpeg,image/png,image/heic,image/gif,video/mp4,video/quicktime,application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document" style="display:none">
        <button class="input-btn send-btn" id="send-btn" onclick="App.sendMessage()" title="Send" aria-label="Send message">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
      </div>
    </div>

    <!-- Member Panel (slide-out right) -->
    <div class="member-panel" id="member-panel"></div>
    <div class="overlay" id="overlay" onclick="Chat.hideMembers()"></div>

    <!-- Lightbox -->
    <div class="lightbox" id="lightbox" onclick="Lightbox.close()">
      <button class="lightbox-close" onclick="Lightbox.close()" aria-label="Close">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none"><path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </button>
      <img id="lightbox-img" src="" alt="Full size image">
    </div>

  </div>

  <!-- iOS Install Banner -->
  <script>
    if (window.navigator.standalone === false) {
      var banner = document.createElement('div');
      banner.className = 'ios-install-banner';
      banner.innerHTML = '<span>Install Titus Messenger: tap <strong>Share</strong> then <strong>Add to Home Screen</strong></span><button onclick="this.parentElement.remove()">Dismiss</button>';
      document.body.appendChild(banner);
    }
  </script>

  <script src="/messenger/attachments.js"></script>
  <script src="/messenger/voice-input.js"></script>
  <script src="/messenger/notifications.js"></script>
  <script src="/messenger/chat.js"></script>
  <script src="/messenger/app.js"></script>
</body>
</html>
